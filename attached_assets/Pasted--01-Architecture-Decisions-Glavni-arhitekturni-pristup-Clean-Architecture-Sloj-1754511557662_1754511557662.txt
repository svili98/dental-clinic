# 01 - Architecture Decisions

## ğŸ—ï¸ Glavni arhitekturni pristup

### Clean Architecture - Slojevi
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Presentation              â”‚ â† Controllers, DTOs, Middleware
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           Application               â”‚ â† Use Cases, Services, Interfaces
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           Domain                    â”‚ â† Entities, Value Objects, Business Rules
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           Infrastructure            â”‚ â† EF Core, Repositories, External Services
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Razlog**: ÄŒista separacija odgovornosti, lakÅ¡e testiranje, nezavisnost od spoljaÅ¡njih biblioteka.

## ğŸ¯ TehnoloÅ¡ki stek - Finalne odluke

### Backend
| Komponenta | Tehnologija | Razlog |
|------------|-------------|---------|
| **Framework** | ASP.NET Core 8.0 | Stabilan, performantan, dobra dokumentacija |
| **ORM** | Entity Framework Core | Code-first pristup, migracije, LINQ |
| **Baza** | PostgreSQL | Open source, skalabilnost, JSON podrÅ¡ka |
| **Validation** | FluentValidation | ÄŒitljivost, separation of concerns |
| **Mapping** | AutoMapper | Automatsko mapiranje izmeÄ‘u slojeva |
| **API Doc** | Swagger/OpenAPI | Automatska dokumentacija |
| **Logging** | Serilog | Strukturisano logovanje |

### Frontend
| Komponenta | Tehnologija | Razlog |
|------------|-------------|---------|
| **Framework** | React 18 + TypeScript | Type safety, komponente, ecosystem |
| **Build Tool** | Vite | Brzina, hot reload, jednostavnost |
| **HTTP Client** | Axios | Interceptori, error handling |
| **State Management** | React Query + useState | Server state odvojeno od UI state |
| **UI Library** | **TBD** | Ant Design vs Material-UI vs custom |
| **Forms** | React Hook Form | Performanse, validacija |
| **Routing** | React Router | Standard za React SPA |

### Infrastructure
| Komponenta | Tehnologija | Razlog |
|------------|-------------|---------|
| **Containerization** | Docker + Docker Compose | Consistency, easy deployment |
| **Reverse Proxy** | Nginx | CORS, static files, load balancing |
| **Database** | PostgreSQL 15+ | Stabilnost, features |

## ğŸ” Alternativni pristupi (razmotreni i odbaÄeni)

### âŒ OdbaÄeno: Mikroservisi
- **Razlog**: Overkill za domain ovve veliÄine
- **PreporuÄeno**: Modularni monolit sa jasnim boundary-jima

### âŒ OdbaÄeno: NoSQL baza
- **Razlog**: Relacijski podaci, potreba za konzistentnost
- **PreporuÄeno**: PostgreSQL sa JSON poljima gde je potrebno

### âŒ OdbaÄeno: GraphQL
- **Razlog**: SloÅ¾enost, overkill za CRUD operacije
- **PreporuÄeno**: RESTful API sa dobrim caching-om

### âŒ OdbaÄeno: Next.js
- **Razlog**: Nepotreban SSR, duplikovanje backend logike
- **PreporuÄeno**: ÄŒisti React SPA

## ğŸ›ï¸ Sloj detaljnije

### Domain Layer
```
Domain/
â”œâ”€â”€ Entities/
â”‚   â”œâ”€â”€ Patient.cs
â”‚   â”œâ”€â”€ Appointment.cs
â”‚   â””â”€â”€ MedicalCondition.cs
â”œâ”€â”€ ValueObjects/
â”‚   â”œâ”€â”€ Address.cs
â”‚   â””â”€â”€ PhoneNumber.cs
â”œâ”€â”€ Enums/
â”‚   â”œâ”€â”€ Gender.cs
â”‚   â””â”€â”€ AppointmentStatus.cs
â””â”€â”€ Interfaces/
    â””â”€â”€ IRepository.cs
```

### Application Layer
```
Application/
â”œâ”€â”€ UseCases/
â”‚   â”œâ”€â”€ Patients/
â”‚   â”‚   â”œâ”€â”€ CreatePatient/
â”‚   â”‚   â”œâ”€â”€ GetPatient/
â”‚   â”‚   â””â”€â”€ UpdatePatient/
â”‚   â””â”€â”€ Appointments/
â”œâ”€â”€ DTOs/
â”œâ”€â”€ Interfaces/
â”œâ”€â”€ Validators/
â””â”€â”€ Mappings/
```

### Infrastructure Layer
```
Infrastructure/
â”œâ”€â”€ Data/
â”‚   â”œâ”€â”€ ApplicationDbContext.cs
â”‚   â”œâ”€â”€ Repositories/
â”‚   â””â”€â”€ Migrations/
â”œâ”€â”€ Services/
â””â”€â”€ Configuration/
```

### Presentation Layer
```
Presentation/
â”œâ”€â”€ Controllers/
â”œâ”€â”€ DTOs/
â”œâ”€â”€ Middleware/
â”œâ”€â”€ Filters/
â””â”€â”€ Extensions/
```

## ğŸ”§ Dependency Injection Strategy

### Registracija servisa
```csharp
// Program.cs
builder.Services.AddScoped<IPatientRepository, PatientRepository>();
builder.Services.AddScoped<IPatientService, PatientService>();
builder.Services.AddAutoMapper(typeof(MappingProfile));
builder.Services.AddValidatorsFromAssembly(typeof(CreatePatientValidator).Assembly);
```

## ğŸ“Š Database Access Pattern

### Repository Pattern
- **Pro**: Testabilnost, abstraction over EF Core
- **Con**: Dodatna kompleksnost

### Direct EF Core u Application layer
- **Pro**: Jednostavnost, direktan LINQ
- **Con**: Vezanost za EF Core

**Odluka**: **Repository Pattern** zbog testabilnosti i buduÄ‡e fleksibilnosti.

## ğŸ¨ Frontend Architecture

### Folder struktura
```
src/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ common/
â”‚   â””â”€â”€ pages/
â”œâ”€â”€ hooks/
â”œâ”€â”€ services/
â”œâ”€â”€ types/
â”œâ”€â”€ utils/
â””â”€â”€ pages/
```

### State Management Philosophy
- **Server State**: React Query (appointments, patients)
- **UI State**: useState, useReducer
- **Global State**: Context API (user, theme)

## ğŸ” Security Considerations

### Authentication (buduÄ‡nost)
- **Izbor**: ASP.NET Core Identity
- **Razlog**: Integrisano, jednostavno, dovoljno za potrebe

### Authorization
- **Role-based**: Doctor, Nurse, Admin
- **Resource-based**: Patient moÅ¾e videti samo svoje podatke

### Data Protection
- **HTTPS**: Obavezno u production
- **CORS**: Konfigurisano za frontend domain
- **Validation**: Na svim nivoima (client, server, database)

## ğŸš€ Performance Strategy

### Database
- **Connection Pooling**: UgraÄ‘eno u Npgsql
- **Indexing**: Composite indeksi za Äeste upite
- **Query Optimization**: IQueryable, async/await

### API
- **Caching**: In-memory cache za reference data
- **Pagination**: Svi list endpoint-i
- **Compression**: Gzip za API responses

### Frontend
- **Code Splitting**: Lazy loading stranica
- **Bundle Optimization**: Vite optimizacija
- **HTTP Caching**: Cache-Control headers

## ğŸ“ SledeÄ‡i koraci

1. âœ… Arhitektura definisana
2. â­ï¸ Database design review
3. â­ï¸ Backend structure planning
4. â­ï¸ Frontend structure planning
5. â­ï¸ Docker setup planning

## ğŸ¤” Otvorena pitanja za diskusiju

1. **UI Library**: Ant Design vs Material-UI vs custom CSS?
2. **Caching**: Redis ili in-memory za poÄetak?
3. **File Upload**: Gdje store slike/dokumenti?
4. **Notification**: Email/SMS provider?
5. **Reporting**: Built-in ili third-party?

Da li se slaÅ¾eÅ¡ sa ovim odlukama ili imaÅ¡ predloge za izmene?